#!/bin/sh

# lf + kitty preview script using mutool for PDF previews
file="$1"
width="$2"
height="$3"
x="$4"
y="$5"

[ -z "$file" ] || [ ! -f "$file" ] && exit 1

mimetype=$(file --mime-type -Lb "$file")

case "$mimetype" in
  image/*)
    kitty +kitten icat --clear --transfer-mode=stream \
      --place="${width}x${height}@${x}x${y}" "$file"
    exit 1
    ;;

  application/pdf)
    # Render first page of PDF to PNG using MuPDF (mutool draw)
    tmpimg="$(mktemp --suffix=.png)"
    mutool draw -o "$tmpimg" -F png -r 144 "$file" 1 || exit 1
    kitty +kitten icat --clear --transfer-mode=stream \
      --place="${width}x${height}@${x}x${y}" "$tmpimg"
    rm -f "$tmpimg"
    exit 1
    ;;
esac

# Default fallback: text preview
bat --style=plain --color=always "$file" 2>/dev/null || cat "$file"
